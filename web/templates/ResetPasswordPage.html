<!-- templates/ResetPasswordPage.html -->
{{# include "./BasePage.html" #}}

{{ define "BodySection" }}
<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 px-4 sm:px-6 lg:px-8">
    <!-- Branding -->
    <div class="absolute top-6 left-6">
        <a href="/" class="flex items-center space-x-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 dark:text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
            </svg>
            <span class="font-bold text-xl text-gray-900 dark:text-white">LilBattle</span>
        </a>
    </div>

    <div class="w-full max-w-md">
        <div class="bg-white dark:bg-gray-800 shadow-2xl rounded-2xl p-8 space-y-6 border border-gray-200 dark:border-gray-700">

            {{if .Success}}
            <!-- Success state -->
            <div class="text-center space-y-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-green-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Password updated</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    Your password has been reset. You can now sign in.
                </p>
                <a href="/login"
                   class="mt-2 inline-flex justify-center py-3 px-6 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition duration-150 ease-in-out">
                    Sign in
                </a>
            </div>

            {{else if .InvalidToken}}
            <!-- Invalid/missing token state -->
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-red-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Invalid reset link</h2>
                <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                    This password reset link is invalid or has expired.
                </p>
                <a href="/forgot-password"
                   class="mt-4 inline-block text-sm font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400">
                    Request a new reset link
                </a>
            </div>

            {{else}}
            <!-- Header with icon -->
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-blue-600 dark:text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Set new password</h2>
                <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                    Choose a strong password with at least 8 characters.
                </p>
            </div>

            {{if .Error}}
            <div class="text-center text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 rounded-lg p-3">
                {{.Error}}
            </div>
            {{end}}

            <!-- Plain form POST -->
            <form method="POST" action="/auth/reset-password" class="space-y-5">
                <input type="hidden" name="token" value="{{.Token}}">

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        New password
                    </label>
                    <div class="relative">
                        <input id="password"
                               name="password"
                               type="password"
                               required
                               minlength="8"
                               autocomplete="new-password"
                               class="appearance-none block w-full px-4 py-3 pr-11 border border-gray-300 dark:border-gray-600 rounded-lg placeholder-gray-400 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out sm:text-sm"
                               placeholder="At least 8 characters"
                               autofocus>
                        <button type="button"
                                id="toggle-password"
                                class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none"
                                aria-label="Toggle password visibility">
                            <svg id="eye-icon" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                            </svg>
                            <svg id="eye-off-icon" class="h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd" />
                                <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div>
                    <label for="confirm-password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Confirm password
                    </label>
                    <input id="confirm-password"
                           name="confirm_password"
                           type="password"
                           required
                           minlength="8"
                           autocomplete="new-password"
                           class="appearance-none block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg placeholder-gray-400 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out sm:text-sm"
                           placeholder="Repeat your password">
                </div>

                <button type="submit"
                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition duration-150 ease-in-out">
                    Reset password
                </button>
            </form>
            {{end}}
        </div>

        <p class="mt-6 text-center text-xs text-gray-600 dark:text-gray-400">
            <a href="/login" class="text-blue-600 hover:text-blue-500 dark:text-blue-400">Back to sign in</a>
        </p>
    </div>
</div>
{{ end }}

{{ define "PostBodySection" }}
<script>
(function() {
    var toggleBtn = document.getElementById('toggle-password');
    if (!toggleBtn) return;
    var passwordInput = document.getElementById('password');
    var confirmInput = document.getElementById('confirm-password');
    var eyeIcon = document.getElementById('eye-icon');
    var eyeOffIcon = document.getElementById('eye-off-icon');

    toggleBtn.addEventListener('click', function() {
        var isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';
        confirmInput.type = isPassword ? 'text' : 'password';
        eyeIcon.classList.toggle('hidden');
        eyeOffIcon.classList.toggle('hidden');
    });
})();
</script>
{{ end }}

{{ define "ResetPasswordPage" }}
{{ template "BasePage" . }}
{{ end }}
