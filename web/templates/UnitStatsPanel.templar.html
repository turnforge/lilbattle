<!-- UnitStatsPanel Template -->
<div
  id="unit-stats-panel-template"
  class="unit-stats-panel h-full bg-white dark:bg-gray-800 p-4 overflow-y-auto"
>
  <h4 class="font-medium text-gray-900 dark:text-white mb-3">‚öîÔ∏è Unit Info</h4>

  <!-- No Selection State -->
  {{ if .Unit }}
  <!-- Selected Unit Info -->
  <div id="unit-details" class="nothidden">
    <!-- Unit Header -->
    <div class="mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
      <div class="flex items-center justify-between mb-2">
        <span id="unit-icon" class="text-2xl w-14">
          <!-- Theme-based image - will be populated by TypeScript -->
          <img
            class="theme-unit-image w-8 h-8 object-contain"
            data-unit-id="{{ .Unit.UnitType }}"
            data-player-id="{{ .Unit.Player }}"
            alt="{{ .Theme.GetUnitName .Unit.UnitType }}"
            style="image-rendering: pixelated"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';"
          />
          <span style="display: none">‚öîÔ∏è</span>
        </span>
        <span id="unit-player" class="text-xs text-gray-500 dark:text-gray-400">
          Player {{ .Unit.Player }}
        </span>
      </div>
      <h5 id="unit-name" class="font-medium text-gray-900 dark:text-white">
        {{ .Theme.GetUnitName .Unit.UnitType }}
      </h5>
      <p
        id="unit-description"
        class="text-sm text-gray-600 dark:text-gray-300 mt-1"
      >
        {{ if .Theme.GetUnitDescription .Unit.UnitType }} {{
        .Theme.GetUnitDescription .Unit.UnitType }} {{ else }} {{ $unitDef :=
        index .RulesTable.Units .Unit.UnitType }} {{ if $unitDef }}{{
        $unitDef.Description }}{{ end }} {{ end }}
      </p>
    </div>

    <!-- Unit Stats -->
    <div class="grid grid-cols-2 gap-3 mb-4">
      <!-- Health -->
      <div class="bg-red-50 dark:bg-red-900/20 p-2 rounded">
        <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
          ‚ù§Ô∏è Health
        </div>
        <div
          id="unit-health"
          class="text-lg font-semibold text-red-600 dark:text-red-400"
        >
          100
        </div>
      </div>

      <!-- Movement -->
      <div class="bg-blue-50 dark:bg-blue-900/20 p-2 rounded">
        <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
          ‚ö° Movement
        </div>
        <div
          id="unit-movement"
          class="text-lg font-semibold text-blue-600 dark:text-blue-400"
        >
          3
        </div>
      </div>

      <!-- Attack Range -->
      <div class="bg-orange-50 dark:bg-orange-900/20 p-2 rounded">
        <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
          üéØ Range
        </div>
        <div
          id="unit-range"
          class="text-lg font-semibold text-orange-600 dark:text-orange-400"
        >
          1
        </div>
      </div>

      <!-- Status -->
      <div class="bg-green-50 dark:bg-green-900/20 p-2 rounded">
        <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">
          üìç Status
        </div>
        <div
          id="unit-status"
          class="text-sm font-semibold text-green-600 dark:text-green-400"
        >
          Ready
        </div>
      </div>
    </div>

    <!-- Unit Properties -->
    <div id="unit-properties" class="mb-4">
      <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        ‚öôÔ∏è Unit Properties
      </h6>
      <div id="unit-properties-list" class="space-y-1">
        <!-- Unit properties will be populated dynamically -->
      </div>
    </div>

    <!-- Unit-Terrain Properties Section -->
    <div id="unit-terrain-properties" class="mb-4">
      {{/* Generate terrain properties table */}} {{ $unitId := .Unit.UnitType
      }} {{ $rulesTable := .RulesTable }} {{ $theme := .Theme }} {{/* Get
      terrain IDs from theme - ensures consistency and allows theme
      customization */}} {{ $terrainIds := $theme.GetAvailableTerrains }}

      <div class="mt-4">
        <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          üåç Terrain Movement
        </h6>
        <div class="overflow-x-auto">
          <table
            class="min-w-full text-xs border border-gray-200 dark:border-gray-600 rounded-lg"
          >
            <thead class="bg-gray-50 dark:bg-gray-700">
              <tr>
                <th
                  class="px-2 py-2 text-left font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Terrain
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Attack
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Defense
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Move Cost
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Healing
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Capture
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white"
                >
                  Build
                </th>
              </tr>
            </thead>
            <tbody
              class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600"
            >
              {{/* Iterate over terrain IDs from theme */}} {{ range $index,
              $terrainId := $terrainIds }} {{/* Get terrain-unit properties
              using key format "terrainId:unitId" */}} {{ $key := printf "%d:%d"
              $terrainId $unitId }} {{ $props := index
              $rulesTable.TerrainUnitProperties $key }} {{ $terrainDef := index
              $rulesTable.Terrains $terrainId }} {{/* Only show row if terrain
              exists in rules */}} {{ if $terrainDef }}
              <tr
                class="hover:bg-gray-50 dark:hover:bg-gray-700 {{ if (Modulo $index 2) }}bg-gray-50 dark:bg-gray-700{{ end }}"
              >
                <td
                  class="px-2 py-2 text-left text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600 font-medium"
                >
                  {{/* Use theme-specific terrain name */}} {{
                  $theme.GetTerrainName $terrainId }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props (ne $props.AttackBonus 0) }} {{ if gt
                  $props.AttackBonus 0 }}+{{ end }}{{ $props.AttackBonus }} {{
                  else }}-{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props (ne $props.DefenseBonus 0) }} {{ if gt
                  $props.DefenseBonus 0 }}+{{ end }}{{ $props.DefenseBonus }} {{
                  else }}-{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200
                  dark:border-gray-600 {{ if and $props (ge $props.MovementCost 999.0) }}text-red-600 dark:text-red-400{{ end }}"
                >
                  {{ if $props }} {{ if ge $props.MovementCost 999.0 }} Impassable
                  {{ else }} {{ printf "%.2f" $props.MovementCost }} {{ end }}
                  {{ else }}1.00{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props (gt $props.HealingBonus 0) }} +{{
                  $props.HealingBonus }} {{ else }}-{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props $props.CanCapture }}‚úì{{ else }}-{{ end }}
                </td>
                <td class="px-2 py-2 text-center text-gray-900 dark:text-white">
                  {{ if and $props $props.CanBuild }}‚úì{{ else }}-{{ end }}
                </td>
              </tr>
              {{ end }} {{ end }}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {{ else }}
  <div id="no-unit-selected" class="text-center py-8">
    <div class="text-gray-400 dark:text-gray-500 mb-2">
      <svg class="w-12 h-12 mx-auto" fill="currentColor" viewBox="0 0 20 20">
        <path
          d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
        />
      </svg>
    </div>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      Click on a unit to view<br />detailed unit information
    </p>
  </div>
  {{ end }}
</div>
