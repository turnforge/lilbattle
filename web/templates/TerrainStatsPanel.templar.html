<!-- TerrainStatsPanel Template -->
<div
  id="terrain-stats-panel-template"
  class="terrain-stats-panel bg-white dark:bg-gray-800 p-4 overflow-y-auto h-full"
>
  <h4 class="font-medium text-gray-900 dark:text-white mb-3">
    üåç Terrain Info
  </h4>

  {{ if .Tile }}
  <!-- Selected Terrain Info -->
  <div id="terrain-details" class="nothidden">
    <!-- Terrain Header -->
    <div class="mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
      <div class="flex items-center justify-between mb-2">
        <span id="terrain-icon" class="text-2xl w-14">
          <!-- Theme-based image - will be populated by TypeScript -->
          <img
            class="theme-tile-image w-8 h-8 object-contain"
            data-tile-id="{{ .Tile.TileType }}"
            data-player-id="{{ .Tile.Player }}"
            alt="{{ .Theme.GetTerrainName .Tile.TileType }}"
            style="image-rendering: pixelated"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';"
          />
          <span style="display: none">üå±</span>
        </span>
        <span
          id="terrain-coordinates"
          class="text-xs text-gray-500 dark:text-gray-400"
        >
          ({{ .Tile.Q }}, {{ .Tile.R }})
        </span>
      </div>
      <h5 id="terrain-name" class="font-medium text-gray-900 dark:text-white">
        {{ .Theme.GetTerrainName .Tile.TileType }}
      </h5>
      <p
        id="terrain-description"
        class="text-sm text-gray-600 dark:text-gray-300 mt-1"
      >
        {{ if .Theme.GetTerrainDescription .Tile.TileType }} {{
        .Theme.GetTerrainDescription .Tile.TileType }} {{ else }} {{ $terrainDef
        := index .RulesTable.Terrains .Tile.TileType }} {{ if $terrainDef }}{{
        $terrainDef.Description }}{{ end }} {{ end }}
      </p>
    </div>

    <!-- Player Ownership (if applicable) -->
    {{ if gt .Tile.Player 0 }}
    <div id="player-ownership" class="mb-4">
      <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        üë§ Owner
      </h6>
      <div class="bg-purple-50 dark:bg-purple-900/20 p-2 rounded">
        <span
          id="owner-player"
          class="text-sm font-medium text-purple-600 dark:text-purple-400"
        >
          Player {{ .Tile.Player }}
        </span>
      </div>
    </div>
    {{ end }}

    <!-- Unit-Terrain Properties Section -->
    <div id="terrain-unit-properties" class="mb-4">
      {{/* Generate unit interaction table */}} {{ $terrainId := .Tile.TileType
      }} {{ $rulesTable := .RulesTable }} {{ $theme := .Theme }} {{/* Get unit
      IDs from theme - ensures consistency and allows theme customization */}}
      {{ $unitIds := $theme.GetAvailableUnits }}

      <div class="mt-4">
        <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          üéØ Unit Interactions
        </h6>
        <div class="overflow-x-auto">
          <table
            class="min-w-full text-xs border border-gray-200 dark:border-gray-600 rounded-lg"
          >
            <thead class="bg-gray-50 dark:bg-gray-700">
              <tr>
                <th
                  class="px-2 py-2 text-left font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Unit
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Attack
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Defense
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Move Cost
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Healing
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  Capture
                </th>
                <th
                  class="px-2 py-2 text-center font-medium text-gray-900 dark:text-white"
                >
                  Build
                </th>
              </tr>
            </thead>
            <tbody
              class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600"
            >
              {{/* Iterate over unit IDs from theme */}} {{ range $index,
              $unitId := $unitIds }} {{/* Get terrain-unit properties using key
              format "terrainId:unitId" */}} {{ $key := printf "%d:%d"
              $terrainId $unitId }} {{ $props := index
              $rulesTable.TerrainUnitProperties $key }} {{ $unitDef := index
              $rulesTable.Units $unitId }} {{/* Only show row if unit exists in
              rules */}} {{ if $unitDef }}
              <tr
                class="hover:bg-gray-50 dark:hover:bg-gray-700 {{ if (Modulo $index 2) }}bg-gray-50 dark:bg-gray-700{{ end }}"
              >
                <td
                  class="px-2 py-2 text-left text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600 font-medium"
                >
                  {{/* Use theme-specific unit name */}} {{ $theme.GetUnitName
                  $unitId }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props (ne $props.AttackBonus 0) }} {{ if gt
                  $props.AttackBonus 0 }}+{{ end }}{{ $props.AttackBonus }} {{
                  else }}-{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props (ne $props.DefenseBonus 0) }} {{ if gt
                  $props.DefenseBonus 0 }}+{{ end }}{{ $props.DefenseBonus }} {{
                  else }}-{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200
                      dark:border-gray-600 {{ if and $props (ge $props.MovementCost 999.0) }}text-red-600 dark:text-red-400{{ end }}"
                >
                  {{ if $props }} {{ if ge $props.MovementCost 999.0 }}
                  Impassable {{ else }} {{ printf "%.2f" $props.MovementCost }}
                  {{ end }} {{ else }}1.00{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props (gt $props.HealingBonus 0) }} +{{
                  $props.HealingBonus }} {{ else }}-{{ end }}
                </td>
                <td
                  class="px-2 py-2 text-center text-gray-900 dark:text-white border-r border-gray-200 dark:border-gray-600"
                >
                  {{ if and $props $props.CanCapture }}‚úì{{ else }}-{{ end }}
                </td>
                <td class="px-2 py-2 text-center text-gray-900 dark:text-white">
                  {{ if and $props $props.CanBuild }}‚úì{{ else }}-{{ end }}
                </td>
              </tr>
              {{ end }} {{ end }}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  {{ else }}
  <!-- No Selection State -->
  <div id="no-terrain-selected" class="text-center py-8">
    <div class="text-gray-400 dark:text-gray-500 mb-2">
      <svg class="w-12 h-12 mx-auto" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 2L3 7v11a1 1 0 001 1h3v-7h6v7h3a1 1 0 001-1V7l-7-5z" />
      </svg>
    </div>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      Click on a tile to view<br />terrain information
    </p>
  </div>
  {{ end }}
</div>
