<!-- templates/ForgotPasswordPage.html -->
{{# include "./BasePage.html" #}}

{{ define "BodySection" }}
<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 px-4 sm:px-6 lg:px-8">
    <!-- Branding -->
    <div class="absolute top-6 left-6">
        <a href="/" class="flex items-center space-x-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600 dark:text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" />
            </svg>
            <span class="font-bold text-xl text-gray-900 dark:text-white">LilBattle</span>
        </a>
    </div>

    <div class="w-full max-w-md">
        <div class="bg-white dark:bg-gray-800 shadow-2xl rounded-2xl p-8 space-y-6 border border-gray-200 dark:border-gray-700">
            <!-- Header with icon -->
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-blue-600 dark:text-blue-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Forgot your password?</h2>
                <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                    Enter your email address and we'll send you a link to reset your password.
                </p>
            </div>

            <!-- Error message -->
            <div id="error-msg" class="hidden text-center text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 rounded-lg p-3"></div>

            <!-- Success message (hidden by default) -->
            <div id="success-msg" class="hidden text-center space-y-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-green-500 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Check your email</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    If an account exists with that email, we've sent password reset instructions.
                </p>
                <p class="text-xs text-gray-500 dark:text-gray-500">
                    Didn't receive the email? Check your spam folder or
                    <a href="#" id="try-again-link" class="text-blue-600 hover:text-blue-500 dark:text-blue-400">try again</a>.
                </p>
            </div>

            <!-- Form -->
            <form id="forgot-form" class="space-y-5">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Email address
                    </label>
                    <input id="email"
                           name="email"
                           type="email"
                           required
                           autocomplete="email"
                           class="appearance-none block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg placeholder-gray-400 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-150 ease-in-out sm:text-sm"
                           placeholder="you@example.com"
                           autofocus>
                </div>

                <button id="submit-btn"
                        type="submit"
                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition duration-150 ease-in-out">
                    Send reset link
                </button>
            </form>
        </div>

        <p class="mt-6 text-center text-xs text-gray-600 dark:text-gray-400">
            <a href="/login" class="text-blue-600 hover:text-blue-500 dark:text-blue-400">Back to sign in</a>
        </p>
    </div>
</div>
{{ end }}

{{ define "PostBodySection" }}
<script>
(function() {
    var form = document.getElementById('forgot-form');
    var errorMsg = document.getElementById('error-msg');
    var successMsg = document.getElementById('success-msg');
    var submitBtn = document.getElementById('submit-btn');
    var tryAgainLink = document.getElementById('try-again-link');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        errorMsg.classList.add('hidden');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';

        var params = new URLSearchParams(new FormData(form));
        fetch('/auth/forgot-password', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: params
        }).then(function() {
            form.classList.add('hidden');
            successMsg.classList.remove('hidden');
        }).catch(function() {
            errorMsg.textContent = 'Something went wrong. Please try again.';
            errorMsg.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Send reset link';
        });
    });

    if (tryAgainLink) {
        tryAgainLink.addEventListener('click', function(e) {
            e.preventDefault();
            form.classList.remove('hidden');
            successMsg.classList.add('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Send reset link';
            document.getElementById('email').value = '';
            document.getElementById('email').focus();
        });
    }
})();
</script>
{{ end }}

{{ define "ForgotPasswordPage" }}
{{ template "BasePage" . }}
{{ end }}
